[[install-config-install-disconnected-install]]
= 断开连接的安装
{product-author}
{product-version}
:major-tag: v3.11
:latest-tag: v3.11.82
:latest-int-tag: v3.11.82
:latest-registry-console-tag: v3.11.82
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]

数据中心的某些部分可能频繁无法访问网络，甚至无法通过代理服务器访问网络。
您仍然可以在这些环境中安装{product-title}，
但是您必须下载所需的软件和映像，并将它们提供给断开连接的环境。

安装组件对节点主机可用之后，按照标准安装步骤安装{product-title}。

在安装{product-title}之后，必须使您提取的S2I构建器映像对集群可用。

[[disconnected-prerequisites]]
== 先决条件

* 回顾
xref:../architecture/index.adoc#architecture-index[{product-title}的总体体系结构]
并计划您的环境拓扑。

* 获得一个Red Hat Enterprise Linux (RHEL)7服务器，该服务器具有根访问权限，可以访问网络和至少110GB的磁盘空间。
您将所需的软件存储库和容器映像下载到此计算机。

* 计划在断开连接的环境中维护web服务器，以提供镜像存储库。
您可以通过网络或在断开连接的部署中使用物理媒体将存储库从网络连接的主机复制到此Web服务器。

* 提供源代码控制存储库。安装之后，节点必须访问源代码存储库中的源代码，比如Git。
+
当在{product-title}中构建应用程序时，您的构建可能包含外部依赖项，例如用于Ruby应用程序的Maven存储库或Gem文件。

* 在断开连接的环境中提供注册表。选项包括:
** 安装一个
xref:../install/stand_alone_registry.adoc#install-config-installing-stand-alone-registry[独立{product-title}注册表]。
** 使用一个
link:https://access.redhat.com/documentation/en/red-hat-satellite/[Red Hat Satellite6.1]充当容器映像注册表的服务器。
////
由于这个原因，也因为它们可能需要某些标记，{product-title}提供的许多
Quickstart模板可能无法在断开连接的环境中工作。
然而，虽然Red Hat容器映像默认情况下尝试访问外部存储库，但是您可以配置
{product-title}来使用您自己的内部存储库。出于本文档的目的，我们假设这样的内部存储库已经存在，
并且可以从{product-title}节点主机访问。安装这样的存储库超出了本文档的范围。
////

[[disconnected-required-software-and-components]]
== 获取所需的软件包和图像

在断开连接的环境中安装{product-title}之前，获取所需的映像和组件并将它们存储在存储库中。

[[disconnected-syncing-repos]]
===  获取{product-title}包

在具有互联网连接的RHEL 7服务器上，同步存储库:

. 为确保同步资料库后不会删除套件，请输入GPG密钥:
+
[source, bash]
----
$ rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
----

. 向Red Hat客户门户注册服务器。您必须使用与有权访问{product-title}订阅的帐户相关联的凭据:
+
[source, bash]
----
$ subscription-manager register
----

. 从RHSM获取最新订阅数据:
+
[source, bash]
----
$ subscription-manager refresh
----

. 附加一个提供{product-title}通道的订阅。
.. 找到一个提供{product-title}通道的可用订阅池:
+
[source, bash]
----
$ subscription-manager list --available --matches '*OpenShift*'
----

.. 为提供{product-title}的订阅添加池ID:
+
[source, bash]
----
$ subscription-manager attach --pool=<pool_id>
$ subscription-manager repos --disable="*"
$ subscription-manager repos \
    --enable="rhel-7-server-rpms" \
    --enable="rhel-7-server-extras-rpms" \
    --enable="rhel-7-server-ansible-2.6-rpms" \
    --enable="rhel-7-server-ose-3.11-rpms"
----

. 安装所需要的包:
+
[source, bash]
----
$ sudo yum -y install yum-utils createrepo docker git
----
+
 `yum-utils` 包提供了制作一个目录将软件存储在服务器的存储器或USB驱动器或其他外部设备: *reposync* 应用程序，它允许您镜像yum存储库，
并且您可以使用 `createrepo` 包从目录创建一个可用的 `yum` 存储库。

. 制作一个目录将软件存储在服务器的存储器或USB驱动器或其他外部设备:
+
[source, bash]
----
$ mkdir -p </path/to/repos>
----
+
[IMPORTANT]
====
如果可以将此服务器重新连接到断开连接的LAN并将其用作存储库服务器，请在本地存储文件。
如果不能，请使用usb连接的存储，以便可以将软件传输到断开连接的LAN中的存储库服务器。
====

. 同步包，并为每个包创建存储库:
+
[source, bash]
----
$ for repo in \
rhel-7-server-rpms \
rhel-7-server-extras-rpms \
rhel-7-server-ansible-2.6-rpms \
rhel-7-server-ose-3.11-rpms
do
  reposync --gpgcheck -lm --repoid=${repo} --download_path=</path/to/repos> <1>
  createrepo -v </path/to/repos/>${repo} -o </path/to/repos/>${repo} <1>
done
----
<1> 提供您创建的目录的路径。

[[disconnected-syncing-images]]
=== 获取的图像

提取所需的容器图像:

. 启动Docker守护进程:
+
[source, bash]
----
$ systemctl start docker
----

. 提取所有必需的{product-title}基础设施组件映像。
ifdef::openshift-enterprise[]
用要安装的版本替换 `<tag>`。例如，为最新版本指定 `{latest-tag}`。
您可以指定一个不同的次要版本。
endif::[]
+
[source, bash]
----
$ docker pull registry.redhat.io/openshift3/apb-base:<tag>
$ docker pull registry.redhat.io/openshift3/apb-tools:<tag>
$ docker pull registry.redhat.io/openshift3/automation-broker-apb:<tag>
$ docker pull registry.redhat.io/openshift3/csi-attacher:<tag>
$ docker pull registry.redhat.io/openshift3/csi-driver-registrar:<tag>
$ docker pull registry.redhat.io/openshift3/csi-livenessprobe:<tag>
$ docker pull registry.redhat.io/openshift3/csi-provisioner:<tag>
$ docker pull registry.redhat.io/openshift3/grafana:<tag>
$ docker pull registry.redhat.io/openshift3/mariadb-apb:<tag>
$ docker pull registry.redhat.io/openshift3/mediawiki:<tag>
$ docker pull registry.redhat.io/openshift3/mediawiki-apb:<tag>
$ docker pull registry.redhat.io/openshift3/mysql-apb:<tag>
$ docker pull registry.redhat.io/openshift3/ose-ansible:<tag>
$ docker pull registry.redhat.io/openshift3/ose-ansible-service-broker:<tag>
$ docker pull registry.redhat.io/openshift3/ose-cli:<tag>
$ docker pull registry.redhat.io/openshift3/ose-cluster-autoscaler:<tag>
$ docker pull registry.redhat.io/openshift3/ose-cluster-capacity:<tag>
$ docker pull registry.redhat.io/openshift3/ose-cluster-monitoring-operator:<tag>
$ docker pull registry.redhat.io/openshift3/ose-console:<tag>
$ docker pull registry.redhat.io/openshift3/ose-configmap-reloader:<tag>
$ docker pull registry.redhat.io/openshift3/ose-control-plane:<tag>
$ docker pull registry.redhat.io/openshift3/ose-deployer:<tag>
$ docker pull registry.redhat.io/openshift3/ose-descheduler:<tag>
$ docker pull registry.redhat.io/openshift3/ose-docker-builder:<tag>
$ docker pull registry.redhat.io/openshift3/ose-docker-registry:<tag>
$ docker pull registry.redhat.io/openshift3/ose-efs-provisioner:<tag>
$ docker pull registry.redhat.io/openshift3/ose-egress-dns-proxy:<tag>
$ docker pull registry.redhat.io/openshift3/ose-egress-http-proxy:<tag>
$ docker pull registry.redhat.io/openshift3/ose-egress-router:<tag>
$ docker pull registry.redhat.io/openshift3/ose-haproxy-router:<tag>
$ docker pull registry.redhat.io/openshift3/ose-hyperkube:<tag>
$ docker pull registry.redhat.io/openshift3/ose-hypershift:<tag>
$ docker pull registry.redhat.io/openshift3/ose-keepalived-ipfailover:<tag>
$ docker pull registry.redhat.io/openshift3/ose-kube-rbac-proxy:<tag>
$ docker pull registry.redhat.io/openshift3/ose-kube-state-metrics:<tag>
$ docker pull registry.redhat.io/openshift3/ose-metrics-server:<tag>
$ docker pull registry.redhat.io/openshift3/ose-node:<tag>
$ docker pull registry.redhat.io/openshift3/ose-node-problem-detector:<tag>
$ docker pull registry.redhat.io/openshift3/ose-operator-lifecycle-manager:<tag>
$ docker pull registry.redhat.io/openshift3/ose-pod:<tag>
$ docker pull registry.redhat.io/openshift3/ose-prometheus-config-reloader:<tag>
$ docker pull registry.redhat.io/openshift3/ose-prometheus-operator:<tag>
$ docker pull registry.redhat.io/openshift3/ose-recycler:<tag>
$ docker pull registry.redhat.io/openshift3/ose-service-catalog:<tag>
$ docker pull registry.redhat.io/openshift3/ose-template-service-broker:<tag>
$ docker pull registry.redhat.io/openshift3/ose-web-console:<tag>
$ docker pull registry.redhat.io/openshift3/postgresql-apb:<tag>
$ docker pull registry.redhat.io/openshift3/registry-console:<tag>
$ docker pull registry.redhat.io/openshift3/snapshot-controller:<tag>
$ docker pull registry.redhat.io/openshift3/snapshot-provisioner:<tag>
$ docker pull registry.redhat.io/rhel7/etcd:3.2.22

----

. 为可选组件提取所有必需的{product-title}组件映像。
ifdef::openshift-enterprise[]
用要安装的版本替换 `<tag>`。例如，为最新版本指定 `{latest-tag}`。
您可以指定一个不同的次要版本。
endif::[]
+
[source, bash]
----
$ docker pull registry.redhat.io/openshift3/metrics-cassandra:<tag>
$ docker pull registry.redhat.io/openshift3/metrics-hawkular-metrics:<tag>
$ docker pull registry.redhat.io/openshift3/metrics-hawkular-openshift-agent:<tag>
$ docker pull registry.redhat.io/openshift3/metrics-heapster:<tag>
$ docker pull registry.redhat.io/openshift3/metrics-schema-installer:<tag>
$ docker pull registry.redhat.io/openshift3/oauth-proxy:<tag>
$ docker pull registry.redhat.io/openshift3/ose-logging-curator5:<tag>
$ docker pull registry.redhat.io/openshift3/ose-logging-elasticsearch5:<tag>
$ docker pull registry.redhat.io/openshift3/ose-logging-eventrouter:<tag>
$ docker pull registry.redhat.io/openshift3/ose-logging-fluentd:<tag>
$ docker pull registry.redhat.io/openshift3/ose-logging-kibana5:<tag>
$ docker pull registry.redhat.io/openshift3/prometheus:<tag>
$ docker pull registry.redhat.io/openshift3/prometheus-alert-buffer:<tag>
$ docker pull registry.redhat.io/openshift3/prometheus-alertmanager:<tag>
$ docker pull registry.redhat.io/openshift3/prometheus-node-exporter:<tag>
$ docker pull registry.redhat.io/cloudforms46/cfme-openshift-postgresql
$ docker pull registry.redhat.io/cloudforms46/cfme-openshift-memcached
$ docker pull registry.redhat.io/cloudforms46/cfme-openshift-app-ui
$ docker pull registry.redhat.io/cloudforms46/cfme-openshift-app
$ docker pull registry.redhat.io/cloudforms46/cfme-openshift-embedded-ansible
$ docker pull registry.redhat.io/cloudforms46/cfme-openshift-httpd
$ docker pull registry.redhat.io/cloudforms46/cfme-httpd-configmap-generator
$ docker pull registry.redhat.io/rhgs3/rhgs-server-rhel7
$ docker pull registry.redhat.io/rhgs3/rhgs-volmanager-rhel7
$ docker pull registry.redhat.io/rhgs3/rhgs-gluster-block-prov-rhel7
$ docker pull registry.redhat.io/rhgs3/rhgs-s3-server-rhel7
----
+
[IMPORTANT]
====
对于Red Hat的支持，`rhgs3/` 图像需要一个{gluster-native}订阅。
====
+
[IMPORTANT]
====
在{product-title}中Prometheus只是一个技术预览功能。
ifdef::openshift-enterprise[]
Red Hat生产服务水平协议(SLA)不支持技术预览功能，功能上可能不完整，Red Hat不建议在生产中使用这些功能。
这些特性提供了对即将到来的产品特性的早期访问，使客户能够在开发过程中测试功能并提供反馈。

有关Red Hat技术预览功能支持范围的更多信息，请参见
https://access.redhat.com/support/offerings/techpreview/.
endif::[]
====

. 使用Red Hat认证的
xref:../architecture/core_concepts/builds_and_image_streams.adoc#source-build[Source-to-Image(S2I)]在您的{product-title}环境中构建映射器映像。
+
请确保通过指定版本号来指示正确的标记。有关图像版本兼容性的详细信息，请参见链接中的S2I表：
link:https://access.redhat.com/articles/2176281[OpenShift和Atomic Platform集成测试页面]。
+
////
例如，要同时提取Tomcat映像的前一个和最新版本:
+
[source, bash]
----
$ docker pull registry.redhat.io/jboss-webserver-3/webserver30-tomcat7-openshift:latest
$ docker pull registry.redhat.io/jboss-webserver-3/webserver30-tomcat7-openshift:1.1
----
////
+
你可以拉出以下图片:
+
[source, bash]
----
$ docker pull registry.redhat.io/jboss-amq-6/amq63-openshift:<tag>
$ docker pull registry.redhat.io/jboss-datagrid-7/datagrid71-openshift:<tag>
$ docker pull registry.redhat.io/jboss-datagrid-7/datagrid71-client-openshift:<tag>
$ docker pull registry.redhat.io/jboss-datavirt-6/datavirt63-openshift:<tag>
$ docker pull registry.redhat.io/jboss-datavirt-6/datavirt63-driver-openshift:<tag>
$ docker pull registry.redhat.io/jboss-decisionserver-6/decisionserver64-openshift:<tag>
$ docker pull registry.redhat.io/jboss-processserver-6/processserver64-openshift:<tag>
$ docker pull registry.redhat.io/jboss-eap-6/eap64-openshift:<tag>
$ docker pull registry.redhat.io/jboss-eap-7/eap71-openshift:<tag>
$ docker pull registry.redhat.io/jboss-webserver-3/webserver31-tomcat7-openshift:<tag>
$ docker pull registry.redhat.io/jboss-webserver-3/webserver31-tomcat8-openshift:<tag>
$ docker pull registry.redhat.io/openshift3/jenkins-2-rhel7:<tag>
$ docker pull registry.redhat.io/openshift3/jenkins-agent-maven-35-rhel7:<tag>
$ docker pull registry.redhat.io/openshift3/jenkins-agent-nodejs-8-rhel7:<tag>
$ docker pull registry.redhat.io/openshift3/jenkins-slave-base-rhel7:<tag>
$ docker pull registry.redhat.io/openshift3/jenkins-slave-maven-rhel7:<tag>
$ docker pull registry.redhat.io/openshift3/jenkins-slave-nodejs-rhel7:<tag>
$ docker pull registry.redhat.io/rhscl/mongodb-32-rhel7:<tag>
$ docker pull registry.redhat.io/rhscl/mysql-57-rhel7:<tag>
$ docker pull registry.redhat.io/rhscl/perl-524-rhel7:<tag>
$ docker pull registry.redhat.io/rhscl/php-56-rhel7:<tag>
$ docker pull registry.redhat.io/rhscl/postgresql-95-rhel7:<tag>
$ docker pull registry.redhat.io/rhscl/python-35-rhel7:<tag>
$ docker pull registry.redhat.io/redhat-sso-7/sso70-openshift:<tag>
$ docker pull registry.redhat.io/rhscl/ruby-24-rhel7:<tag>
$ docker pull registry.redhat.io/redhat-openjdk-18/openjdk18-openshift:<tag>
$ docker pull registry.redhat.io/redhat-sso-7/sso71-openshift:<tag>
$ docker pull registry.redhat.io/rhscl/nodejs-6-rhel7:<tag>
$ docker pull registry.redhat.io/rhscl/mariadb-101-rhel7:<tag>
----

[[disconnected-preparing-images-for-export]]
=== 导出图像
如果您的环境无法访问您的内部网络，并且需要物理媒体来传输内容，
那么将图像导出到压缩文件中。如果您的主机同时连接到互联网和内部网络，
则跳过以下步骤，继续执行
xref:disconnected-repo-server[准备并填充存储库服务器]。

. 创建一个目录存储您的压缩图像，并更改为:
+
[source, bash]
----
$ mkdir </path/to/images>
$ cd </path/to/images>
----

. 导出{product-title}基础设施组件映像:
+
[source, bash]
----
$ docker save -o ose3-images.tar \
    registry.redhat.io/openshift3/apb-base \
    registry.redhat.io/openshift3/apb-tools \
    registry.redhat.io/openshift3/automation-broker-apb \
    registry.redhat.io/openshift3/csi-attacher \
    registry.redhat.io/openshift3/csi-driver-registrar \
    registry.redhat.io/openshift3/csi-livenessprobe \
    registry.redhat.io/openshift3/csi-provisioner \
    registry.redhat.io/openshift3/grafana \
    registry.redhat.io/openshift3/mariadb-apb \
    registry.redhat.io/openshift3/mediawiki \
    registry.redhat.io/openshift3/mediawiki-apb \
    registry.redhat.io/openshift3/mysql-apb \
    registry.redhat.io/openshift3/ose-ansible \
    registry.redhat.io/openshift3/ose-ansible-service-broker \
    registry.redhat.io/openshift3/ose-cli \
    registry.redhat.io/openshift3/ose-cluster-autoscaler \
    registry.redhat.io/openshift3/ose-cluster-capacity \
    registry.redhat.io/openshift3/ose-cluster-monitoring-operator \
    registry.redhat.io/openshift3/ose-console \
    registry.redhat.io/openshift3/ose-configmap-reloader \
    registry.redhat.io/openshift3/ose-control-plane \
    registry.redhat.io/openshift3/ose-deployer \
    registry.redhat.io/openshift3/ose-descheduler \
    registry.redhat.io/openshift3/ose-docker-builder \
    registry.redhat.io/openshift3/ose-docker-registry \
    registry.redhat.io/openshift3/ose-efs-provisioner \
    registry.redhat.io/openshift3/ose-egress-dns-proxy \
    registry.redhat.io/openshift3/ose-egress-http-proxy \
    registry.redhat.io/openshift3/ose-egress-router \
    registry.redhat.io/openshift3/ose-haproxy-router \
    registry.redhat.io/openshift3/ose-hyperkube \
    registry.redhat.io/openshift3/ose-hypershift \
    registry.redhat.io/openshift3/ose-keepalived-ipfailover \
    registry.redhat.io/openshift3/ose-kube-rbac-proxy \
    registry.redhat.io/openshift3/ose-kube-state-metrics \
    registry.redhat.io/openshift3/ose-metrics-server \
    registry.redhat.io/openshift3/ose-node \
    registry.redhat.io/openshift3/ose-node-problem-detector \
    registry.redhat.io/openshift3/ose-operator-lifecycle-manager \
    registry.redhat.io/openshift3/ose-pod \
    registry.redhat.io/openshift3/ose-prometheus-config-reloader \
    registry.redhat.io/openshift3/ose-prometheus-operator \
    registry.redhat.io/openshift3/ose-recycler \
    registry.redhat.io/openshift3/ose-service-catalog \
    registry.redhat.io/openshift3/ose-template-service-broker \
    registry.redhat.io/openshift3/ose-web-console \
    registry.redhat.io/openshift3/postgresql-apb \
    registry.redhat.io/openshift3/registry-console \
    registry.redhat.io/openshift3/snapshot-controller \
    registry.redhat.io/openshift3/snapshot-provisioner \
    registry.redhat.io/rhel7/etcd:3.2.22
----
////
+
[IMPORTANT]
====
对于Red Hat支持，`rhgs3/` 图像需要一个{gluster-native}订阅。
====
////

. 如果您为可选组件同步图像，请导出它们:
+
[source, bash]
----
$ docker save -o ose3-optional-imags.tar \
    registry.redhat.io/openshift3/metrics-cassandra \
    registry.redhat.io/openshift3/metrics-hawkular-metrics \
    registry.redhat.io/openshift3/metrics-hawkular-openshift-agent \
    registry.redhat.io/openshift3/metrics-heapster \
    registry.redhat.io/openshift3/metrics-schema-installer \
    registry.redhat.io/openshift3/oauth-proxy \
    registry.redhat.io/openshift3/ose-logging-curator5 \
    registry.redhat.io/openshift3/ose-logging-elasticsearch5 \
    registry.redhat.io/openshift3/ose-logging-eventrouter \
    registry.redhat.io/openshift3/ose-logging-fluentd \
    registry.redhat.io/openshift3/ose-logging-kibana5 \
    registry.redhat.io/openshift3/prometheus \
    registry.redhat.io/openshift3/prometheus-alert-buffer \
    registry.redhat.io/openshift3/prometheus-alertmanager \
    registry.redhat.io/openshift3/prometheus-node-exporter \
    registry.redhat.io/cloudforms46/cfme-openshift-postgresql \
    registry.redhat.io/cloudforms46/cfme-openshift-memcached \
    registry.redhat.io/cloudforms46/cfme-openshift-app-ui \
    registry.redhat.io/cloudforms46/cfme-openshift-app \
    registry.redhat.io/cloudforms46/cfme-openshift-embedded-ansible \
    registry.redhat.io/cloudforms46/cfme-openshift-httpd \
    registry.redhat.io/cloudforms46/cfme-httpd-configmap-generator \
    registry.redhat.io/rhgs3/rhgs-server-rhel7 \
    registry.redhat.io/rhgs3/rhgs-volmanager-rhel7 \
    registry.redhat.io/rhgs3/rhgs-gluster-block-prov-rhel7 \
    registry.redhat.io/rhgs3/rhgs-s3-server-rhel7
----

. 导出您所提取的S2I构建器映像。例如，如果只同步Jenkins和Tomcat图像:
+
[source, bash]
----
$ docker save -o ose3-builder-images.tar \
    registry.redhat.io/jboss-webserver-3/webserver31-tomcat7-openshift:<tag> \
    registry.redhat.io/jboss-webserver-3/webserver31-tomcat8-openshift:<tag> \
    registry.redhat.io/openshift3/jenkins-2-rhel7:<tag> \
    registry.redhat.io/openshift3/jenkins-agent-maven-35-rhel7:<tag> \
    registry.redhat.io/openshift3/jenkins-agent-nodejs-8-rhel7:<tag> \
    registry.redhat.io/openshift3/jenkins-slave-base-rhel7:<tag> \
    registry.redhat.io/openshift3/jenkins-slave-maven-rhel7:<tag> \
    registry.redhat.io/openshift3/jenkins-slave-nodejs-rhel7:<tag>
----

. 将压缩文件从互联网连接的主机复制到内部主机。

. 载入你复制的图片：
+
[source, bash]
----
$ docker load -i ose3-images.tar
$ docker load -i ose3-builder-images.tar
$ docker load -i ose3-optional-images.tar
----

[[disconnected-repo-server]]
== 准备并填充存储库服务器

在安装过程中，以及以后的任何更新过程中，您都需要一个web服务器来承载软件。
RHEL 7可以提供Apache web服务器。

. 准备网络服务器:
.. 如果您需要在断开连接的环境中安装一个新的web服务器，请在LAN上安装一个新的RHEL 7系统，
该系统至少有110 GB的空间。在RHEL安装过程中，选择 *基本Web服务器* 选项。
.. 如果您正在重用下载了{product-title}软件和所需映像的服务器，请在服务器上安装Apache:
+
[source, bash]
----
$ sudo yum install httpd
----

. 将存储库文件放入 Apacheâ€™s 的根文件夹。
** 如果您正在重用服务器:
+
[source, bash]
----
$ mv /path/to/repos /var/www/html/
$ chmod -R +r /var/www/html/repos
$ restorecon -vR /var/www/html
----

** 如果你安装了一个新的服务器，附加外部存储，然后复制文件:
+
[source, bash]
----
$ cp -a /path/to/repos /var/www/html/
$ chmod -R +r /var/www/html/repos
$ restorecon -vR /var/www/html
----

. 添加防火墙规则:
+
[source, bash]
----
$ sudo firewall-cmd --permanent --add-service=http
$ sudo firewall-cmd --reload
----

. 启用并启动Apache，使更改生效:
+
[source, bash]
----
$ systemctl enable httpd
$ systemctl start httpd
----

[[disconnected-populate-registry]]
== 填充注册表

从您断开连接的环境中，标记并将图像推送到您的内部注册表:

[IMPORTANT]
====
以下步骤是将图像加载到注册表的通用指南。您可能需要采取更多或不同的操作来加载图像。
====

. 在将图像放入注册表之前，请重新标记每个图像。
** 对于 `openshift3` 存储库中的图像，将图像标记为主版本号和副版本号。例如，要标记{product-title}节点图像:
+
[source, bash]
----
$ docker tag registry.redhat.io/openshift3/ose-node:<tag> registry.example.com/openshift3/ose-node:<tag>
$ docker tag registry.redhat.io/openshift3/ose-node:<tag> registry.example.com/openshift3/ose-node:{major-tag}
----
** 对于其他图像，使用准确的版本号标记图像。例如，要标记etcd图像:
+
[source, bash]
----
$ docker tag registry.redhat.io/rhel7/etcd:3.2.22 registry.example.com/rhel7/etcd:3.2.22
----

. 将每个图像推入注册表。例如，要推送{product-title}节点图像:
+
[source, bash]
----
$ docker push registry.example.com/openshift3/ose-node:<tag>
$ docker push registry.example.com/openshift3/ose-node:{major-tag}
----

[[disconnected-openshift-systems]]
== 准备集群主机

现在您已经有了安装文件，准备好您的主机。

. 为您的{product-title}集群创建主机。建议使用最新版本的RHEL 7并执行最小的安装。
确保主机满足xref:../install/prerequisites.adoc#install-config-install-prerequisites[系统需求]。

. 在每个节点主机上，创建存储库定义。将以下文本放在 *_/etc/yum.repos.d/ose.repo_* 文件:
+
----
[rhel-7-server-rpms]
name=rhel-7-server-rpms
baseurl=http://<server_IP>/repos/rhel-7-server-rpms <1>
enabled=1
gpgcheck=0
[rhel-7-server-extras-rpms]
name=rhel-7-server-extras-rpms
baseurl=http://<server_IP>/repos/rhel-7-server-extras-rpms <1>
enabled=1
gpgcheck=0
[rhel-7-server-ansible-2.6-rpms]
name=rhel-7-server-ansible-2.6-rpms
baseurl=http://<server_IP>/repos/rhel-7-server-ansible-2.6-rpms <1>
enabled=1
gpgcheck=0
[rhel-7-server-ose-3.11-rpms]
name=rhel-7-server-ose-3.11-rpms
baseurl=http://<server_IP>/repos/rhel-7-server-ose-3.11-rpms <1>
enabled=1
gpgcheck=0
----
<1> 用承载软件库的Apache服务器的IP地址或主机名替换 `<server_IP>`。

. 完成主机的安装准备工作。遵循
xref:host_preparation.adoc#install-config-install-host-preparation[准备您的主机]步骤，
省略了 *Host Registration* 部分中的步骤。

[[disconnected-installing-openshift]]
== 安装{product-title}

准备好软件，图像和主机后，使用标准安装方法安装{product-title}:

. xref:configuring_inventory_file.adoc#configuring-ansible[配置你的目录文件]参考你的内部注册表:
+
----
oreg_url=registry.example.com/openshift3/ose-${component}:${version}
openshift_examples_modify_imagestreams=true
----

. xref:running_install.adoc#install-running-installation-playbooks[运行安装playbooks]。
////
+
[IMPORTANT]
====
您必须为提取的图像提供 `<tag>` 的值，例如 *{latest-tag}*，
作为 `openshift_image_tag` 参数的值。
如果没有为该参数提供正确的值，安装程序可能尝试访问存储库服务器中没有的映像，
安装可能会失败。
====
////
