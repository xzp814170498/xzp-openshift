[[install-config-install-disconnected-install]]
= Disconnected installation
{product-author}
{product-version}
:major-tag: v3.11
:latest-tag: v3.11.82
:latest-int-tag: v3.11.82
:latest-registry-console-tag: v3.11.82
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]

??,?????????????????,????????????????
?????????????{product-title},
???????????????,???????????????

?????????????,??????????{product-title}?

???{product-title}??,???????S2I???????????

[[disconnected-prerequisites]]
== ????

* ??
xref:../architecture/index.adoc#architecture-index[{product-title}???????]??????????

* ????Red Hat Enterprise Linux (RHEL) 7???,???????????,?????????110GB??????
???????????????????????

* ?????????????Web???,????????????????????????????
????????????????????Web????

* ???????????????,?????????????????,??Git?
+
??{product-title}????????,?????????????,
????Ruby?????Maven????Gem???

* ???????????????????:
** ????
xref:../install/stand_alone_registry.adoc#install-config-installing-stand-alone-registry[??{product-title}???].
** ?? https://access.redhat.com/documentation/en/red-hat-satellite/[Red Hat Satellite
6.1] ???,??????????
////
??????,?????????????,{product-title}?????Quickstart??????????????????
??,??Red Hat??????????????????,???????
{product-title}?????????????????????,
????????????????,?????{product-title}???????
??????????????????
////

[[disconnected-required-software-and-components]]
== ???????????

???????????{product-title}??,??????????????????????

[[disconnected-syncing-repos]]
=== ??{product-title}?

?????????RHEL 7????,?????:

. ???????????????,???GPG??:
+
[source, bash]
----
$ rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
----

. ?Red Hat????????????????????{product-title}
???????????:
+
[source, bash]
----
$ ???????
----

. ?RHSM????????:
+
[source, bash]
----
$ ???????
----

. ??????{product-title}??????
.. ??????{product-title}????????:
+
[source, bash]
----
$ subscription-manager list --available --matches '*OpenShift*'
----

.. ???{product-title}??????ID:
+
[source, bash]
----
$ subscription-manager attach --pool=<pool_id>
$ subscription-manager repos --disable="*"
$ subscription-manager repos \
    --enable="rhel-7-server-rpms" \
    --enable="rhel-7-server-extras-rpms" \
    --enable="rhel-7-server-ansible-2.6-rpms" \
    --enable="rhel-7-server-ose-3.11-rpms"
----

. Install required packages:
+
[source, bash]
----
$ sudo yum -y install yum-utils createrepo docker git
----
+
`yum-utils` ????*reposync*????,??????yum???, 
???????`createrepo`???????????`yum`????

. ????????????????????USB??????????:
+
[source, bash]
----
$ mkdir -p </path/to/repos>
----
+
[IMPORTANT]
====
???????????????????LAN???????????,?????????????,???usb?????,
???????????????LAN?????????
====

. ???,??????????:
+
[source, bash]
----
$ for repo in \
rhel-7-server-rpms \
rhel-7-server-extras-rpms \
rhel-7-server-ansible-2.6-rpms \
rhel-7-server-ose-3.11-rpms
do
  reposync --gpgcheck -lm --repoid=${repo} --download_path=</path/to/repos> <1>
  createrepo -v </path/to/repos/>${repo} -o </path/to/repos/>${repo} <1>
done
----
<1> Provide the path to the directory you created.

[[disconnected-syncing-images]]
=== ?????

?????????:

. ??Docker????:
+
[source, bash]
----
$ systemctl start docker
----

. ???????{product-title}?????????
ifdef::openshift-enterprise[]
?????????`<tag>`???,???????`{latest-tag}`?
???????????????
endif::[]
+
[source, bash]
----
$ docker pull registry.redhat.io/openshift3/apb-base:<tag>
$ docker pull registry.redhat.io/openshift3/apb-tools:<tag>
$ docker pull registry.redhat.io/openshift3/automation-broker-apb:<tag>
$ docker pull registry.redhat.io/openshift3/csi-attacher:<tag>
$ docker pull registry.redhat.io/openshift3/csi-driver-registrar:<tag>
$ docker pull registry.redhat.io/openshift3/csi-livenessprobe:<tag>
$ docker pull registry.redhat.io/openshift3/csi-provisioner:<tag>
$ docker pull registry.redhat.io/openshift3/grafana:<tag>
$ docker pull registry.redhat.io/openshift3/mariadb-apb:<tag>
$ docker pull registry.redhat.io/openshift3/mediawiki:<tag>
$ docker pull registry.redhat.io/openshift3/mediawiki-apb:<tag>
$ docker pull registry.redhat.io/openshift3/mysql-apb:<tag>
$ docker pull registry.redhat.io/openshift3/ose-ansible:<tag>
$ docker pull registry.redhat.io/openshift3/ose-ansible-service-broker:<tag>
$ docker pull registry.redhat.io/openshift3/ose-cli:<tag>
$ docker pull registry.redhat.io/openshift3/ose-cluster-autoscaler:<tag>
$ docker pull registry.redhat.io/openshift3/ose-cluster-capacity:<tag>
$ docker pull registry.redhat.io/openshift3/ose-cluster-monitoring-operator:<tag>
$ docker pull registry.redhat.io/openshift3/ose-console:<tag>
$ docker pull registry.redhat.io/openshift3/ose-configmap-reloader:<tag>
$ docker pull registry.redhat.io/openshift3/ose-control-plane:<tag>
$ docker pull registry.redhat.io/openshift3/ose-deployer:<tag>
$ docker pull registry.redhat.io/openshift3/ose-descheduler:<tag>
$ docker pull registry.redhat.io/openshift3/ose-docker-builder:<tag>
$ docker pull registry.redhat.io/openshift3/ose-docker-registry:<tag>
$ docker pull registry.redhat.io/openshift3/ose-efs-provisioner:<tag>
$ docker pull registry.redhat.io/openshift3/ose-egress-dns-proxy:<tag>
$ docker pull registry.redhat.io/openshift3/ose-egress-http-proxy:<tag>
$ docker pull registry.redhat.io/openshift3/ose-egress-router:<tag>
$ docker pull registry.redhat.io/openshift3/ose-haproxy-router:<tag>
$ docker pull registry.redhat.io/openshift3/ose-hyperkube:<tag>
$ docker pull registry.redhat.io/openshift3/ose-hypershift:<tag>
$ docker pull registry.redhat.io/openshift3/ose-keepalived-ipfailover:<tag>
$ docker pull registry.redhat.io/openshift3/ose-kube-rbac-proxy:<tag>
$ docker pull registry.redhat.io/openshift3/ose-kube-state-metrics:<tag>
$ docker pull registry.redhat.io/openshift3/ose-metrics-server:<tag>
$ docker pull registry.redhat.io/openshift3/ose-node:<tag>
$ docker pull registry.redhat.io/openshift3/ose-node-problem-detector:<tag>
$ docker pull registry.redhat.io/openshift3/ose-operator-lifecycle-manager:<tag>
$ docker pull registry.redhat.io/openshift3/ose-pod:<tag>
$ docker pull registry.redhat.io/openshift3/ose-prometheus-config-reloader:<tag>
$ docker pull registry.redhat.io/openshift3/ose-prometheus-operator:<tag>
$ docker pull registry.redhat.io/openshift3/ose-recycler:<tag>
$ docker pull registry.redhat.io/openshift3/ose-service-catalog:<tag>
$ docker pull registry.redhat.io/openshift3/ose-template-service-broker:<tag>
$ docker pull registry.redhat.io/openshift3/ose-web-console:<tag>
$ docker pull registry.redhat.io/openshift3/postgresql-apb:<tag>
$ docker pull registry.redhat.io/openshift3/registry-console:<tag>
$ docker pull registry.redhat.io/openshift3/snapshot-controller:<tag>
$ docker pull registry.redhat.io/openshift3/snapshot-provisioner:<tag>
$ docker pull registry.redhat.io/rhel7/etcd:3.2.22

----

. ????????????{product-title}?????
ifdef::openshift-enterprise[]
?????????`<tag>`???,???????`{latest-tag}`?
???????????????
endif::[]
+
[source, bash]
----
$ docker pull registry.redhat.io/openshift3/metrics-cassandra:<tag>
$ docker pull registry.redhat.io/openshift3/metrics-hawkular-metrics:<tag>
$ docker pull registry.redhat.io/openshift3/metrics-hawkular-openshift-agent:<tag>
$ docker pull registry.redhat.io/openshift3/metrics-heapster:<tag>
$ docker pull registry.redhat.io/openshift3/metrics-schema-installer:<tag>
$ docker pull registry.redhat.io/openshift3/oauth-proxy:<tag>
$ docker pull registry.redhat.io/openshift3/ose-logging-curator5:<tag>
$ docker pull registry.redhat.io/openshift3/ose-logging-elasticsearch5:<tag>
$ docker pull registry.redhat.io/openshift3/ose-logging-eventrouter:<tag>
$ docker pull registry.redhat.io/openshift3/ose-logging-fluentd:<tag>
$ docker pull registry.redhat.io/openshift3/ose-logging-kibana5:<tag>
$ docker pull registry.redhat.io/openshift3/prometheus:<tag>
$ docker pull registry.redhat.io/openshift3/prometheus-alert-buffer:<tag>
$ docker pull registry.redhat.io/openshift3/prometheus-alertmanager:<tag>
$ docker pull registry.redhat.io/openshift3/prometheus-node-exporter:<tag>
$ docker pull registry.redhat.io/cloudforms46/cfme-openshift-postgresql
$ docker pull registry.redhat.io/cloudforms46/cfme-openshift-memcached
$ docker pull registry.redhat.io/cloudforms46/cfme-openshift-app-ui
$ docker pull registry.redhat.io/cloudforms46/cfme-openshift-app
$ docker pull registry.redhat.io/cloudforms46/cfme-openshift-embedded-ansible
$ docker pull registry.redhat.io/cloudforms46/cfme-openshift-httpd
$ docker pull registry.redhat.io/cloudforms46/cfme-httpd-configmap-generator
$ docker pull registry.redhat.io/rhgs3/rhgs-server-rhel7
$ docker pull registry.redhat.io/rhgs3/rhgs-volmanager-rhel7
$ docker pull registry.redhat.io/rhgs3/rhgs-gluster-block-prov-rhel7
$ docker pull registry.redhat.io/rhgs3/rhgs-s3-server-rhel7
----
+
[IMPORTANT]
====
??Red Hat??,`rhgs3/`??????{gluster-native}???.
====
+
[IMPORTANT]
====
?{product-title}?Prometheus???????????
ifdef::openshift-enterprise[]
Red Hat????????(SLA)?????????,????????,Red Hat??????????????
??????????????????????,
?????????????????????

??Red Hat?????????????,???
https://access.redhat.com/support/offerings/techpreview/.
endif::[]
====

. ???{product-title}?????Red Hat???
xref:../architecture/core_concepts/builds_and_image_streams.adoc#source-build[Source-to-Image(S2I)]?
+
?????????????????????????????????,???????S2I?:
https://access.redhat.com/articles/2176281[OpenShift?Atomic????????]?
+
////
??,?????Tomcat???????????:
+
[source, bash]
----
$ docker pull registry.redhat.io/jboss-webserver-3/webserver30-tomcat7-openshift:latest
$ docker pull registry.redhat.io/jboss-webserver-3/webserver30-tomcat7-openshift:1.1
----
////
+
?????????:
+
[source, bash]
----
$ docker pull registry.redhat.io/jboss-amq-6/amq63-openshift:<tag>
$ docker pull registry.redhat.io/jboss-datagrid-7/datagrid71-openshift:<tag>
$ docker pull registry.redhat.io/jboss-datagrid-7/datagrid71-client-openshift:<tag>
$ docker pull registry.redhat.io/jboss-datavirt-6/datavirt63-openshift:<tag>
$ docker pull registry.redhat.io/jboss-datavirt-6/datavirt63-driver-openshift:<tag>
$ docker pull registry.redhat.io/jboss-decisionserver-6/decisionserver64-openshift:<tag>
$ docker pull registry.redhat.io/jboss-processserver-6/processserver64-openshift:<tag>
$ docker pull registry.redhat.io/jboss-eap-6/eap64-openshift:<tag>
$ docker pull registry.redhat.io/jboss-eap-7/eap71-openshift:<tag>
$ docker pull registry.redhat.io/jboss-webserver-3/webserver31-tomcat7-openshift:<tag>
$ docker pull registry.redhat.io/jboss-webserver-3/webserver31-tomcat8-openshift:<tag>
$ docker pull registry.redhat.io/openshift3/jenkins-2-rhel7:<tag>
$ docker pull registry.redhat.io/openshift3/jenkins-agent-maven-35-rhel7:<tag>
$ docker pull registry.redhat.io/openshift3/jenkins-agent-nodejs-8-rhel7:<tag>
$ docker pull registry.redhat.io/openshift3/jenkins-slave-base-rhel7:<tag>
$ docker pull registry.redhat.io/openshift3/jenkins-slave-maven-rhel7:<tag>
$ docker pull registry.redhat.io/openshift3/jenkins-slave-nodejs-rhel7:<tag>
$ docker pull registry.redhat.io/rhscl/mongodb-32-rhel7:<tag>
$ docker pull registry.redhat.io/rhscl/mysql-57-rhel7:<tag>
$ docker pull registry.redhat.io/rhscl/perl-524-rhel7:<tag>
$ docker pull registry.redhat.io/rhscl/php-56-rhel7:<tag>
$ docker pull registry.redhat.io/rhscl/postgresql-95-rhel7:<tag>
$ docker pull registry.redhat.io/rhscl/python-35-rhel7:<tag>
$ docker pull registry.redhat.io/redhat-sso-7/sso70-openshift:<tag>
$ docker pull registry.redhat.io/rhscl/ruby-24-rhel7:<tag>
$ docker pull registry.redhat.io/redhat-openjdk-18/openjdk18-openshift:<tag>
$ docker pull registry.redhat.io/redhat-sso-7/sso71-openshift:<tag>
$ docker pull registry.redhat.io/rhscl/nodejs-6-rhel7:<tag>
$ docker pull registry.redhat.io/rhscl/mariadb-101-rhel7:<tag>
----

[[disconnected-preparing-images-for-export]]
=== ????
????????????????,?????????????,??????????????
??????????????????,??????????
xref:disconnected-repo-server[???????????]?

. ??????????????,????:
+
[source, bash]
----
$ mkdir </path/to/images>
$ cd </path/to/images>
----

. ??{product-title}????????:
+
[source, bash]
----
$ docker save -o ose3-images.tar \
    registry.redhat.io/openshift3/apb-base \
    registry.redhat.io/openshift3/apb-tools \
    registry.redhat.io/openshift3/automation-broker-apb \
    registry.redhat.io/openshift3/csi-attacher \
    registry.redhat.io/openshift3/csi-driver-registrar \
    registry.redhat.io/openshift3/csi-livenessprobe \
    registry.redhat.io/openshift3/csi-provisioner \
    registry.redhat.io/openshift3/grafana \
    registry.redhat.io/openshift3/mariadb-apb \
    registry.redhat.io/openshift3/mediawiki \
    registry.redhat.io/openshift3/mediawiki-apb \
    registry.redhat.io/openshift3/mysql-apb \
    registry.redhat.io/openshift3/ose-ansible \
    registry.redhat.io/openshift3/ose-ansible-service-broker \
    registry.redhat.io/openshift3/ose-cli \
    registry.redhat.io/openshift3/ose-cluster-autoscaler \
    registry.redhat.io/openshift3/ose-cluster-capacity \
    registry.redhat.io/openshift3/ose-cluster-monitoring-operator \
    registry.redhat.io/openshift3/ose-console \
    registry.redhat.io/openshift3/ose-configmap-reloader \
    registry.redhat.io/openshift3/ose-control-plane \
    registry.redhat.io/openshift3/ose-deployer \
    registry.redhat.io/openshift3/ose-descheduler \
    registry.redhat.io/openshift3/ose-docker-builder \
    registry.redhat.io/openshift3/ose-docker-registry \
    registry.redhat.io/openshift3/ose-efs-provisioner \
    registry.redhat.io/openshift3/ose-egress-dns-proxy \
    registry.redhat.io/openshift3/ose-egress-http-proxy \
    registry.redhat.io/openshift3/ose-egress-router \
    registry.redhat.io/openshift3/ose-haproxy-router \
    registry.redhat.io/openshift3/ose-hyperkube \
    registry.redhat.io/openshift3/ose-hypershift \
    registry.redhat.io/openshift3/ose-keepalived-ipfailover \
    registry.redhat.io/openshift3/ose-kube-rbac-proxy \
    registry.redhat.io/openshift3/ose-kube-state-metrics \
    registry.redhat.io/openshift3/ose-metrics-server \
    registry.redhat.io/openshift3/ose-node \
    registry.redhat.io/openshift3/ose-node-problem-detector \
    registry.redhat.io/openshift3/ose-operator-lifecycle-manager \
    registry.redhat.io/openshift3/ose-pod \
    registry.redhat.io/openshift3/ose-prometheus-config-reloader \
    registry.redhat.io/openshift3/ose-prometheus-operator \
    registry.redhat.io/openshift3/ose-recycler \
    registry.redhat.io/openshift3/ose-service-catalog \
    registry.redhat.io/openshift3/ose-template-service-broker \
    registry.redhat.io/openshift3/ose-web-console \
    registry.redhat.io/openshift3/postgresql-apb \
    registry.redhat.io/openshift3/registry-console \
    registry.redhat.io/openshift3/snapshot-controller \
    registry.redhat.io/openshift3/snapshot-provisioner \
    registry.redhat.io/rhel7/etcd:3.2.22
----
////
+
[IMPORTANT]
====
??Red Hat??, `rhgs3/`??????{gluster-native}???
====
////

. ????????????,?????:
+
[source, bash]
----
$ docker save -o ose3-optional-imags.tar \
    registry.redhat.io/openshift3/metrics-cassandra \
    registry.redhat.io/openshift3/metrics-hawkular-metrics \
    registry.redhat.io/openshift3/metrics-hawkular-openshift-agent \
    registry.redhat.io/openshift3/metrics-heapster \
    registry.redhat.io/openshift3/metrics-schema-installer \
    registry.redhat.io/openshift3/oauth-proxy \
    registry.redhat.io/openshift3/ose-logging-curator5 \
    registry.redhat.io/openshift3/ose-logging-elasticsearch5 \
    registry.redhat.io/openshift3/ose-logging-eventrouter \
    registry.redhat.io/openshift3/ose-logging-fluentd \
    registry.redhat.io/openshift3/ose-logging-kibana5 \
    registry.redhat.io/openshift3/prometheus \
    registry.redhat.io/openshift3/prometheus-alert-buffer \
    registry.redhat.io/openshift3/prometheus-alertmanager \
    registry.redhat.io/openshift3/prometheus-node-exporter \
    registry.redhat.io/cloudforms46/cfme-openshift-postgresql \
    registry.redhat.io/cloudforms46/cfme-openshift-memcached \
    registry.redhat.io/cloudforms46/cfme-openshift-app-ui \
    registry.redhat.io/cloudforms46/cfme-openshift-app \
    registry.redhat.io/cloudforms46/cfme-openshift-embedded-ansible \
    registry.redhat.io/cloudforms46/cfme-openshift-httpd \
    registry.redhat.io/cloudforms46/cfme-httpd-configmap-generator \
    registry.redhat.io/rhgs3/rhgs-server-rhel7 \
    registry.redhat.io/rhgs3/rhgs-volmanager-rhel7 \
    registry.redhat.io/rhgs3/rhgs-gluster-block-prov-rhel7 \
    registry.redhat.io/rhgs3/rhgs-s3-server-rhel7
----

. ???????S2I????????,?????Jenkins?Tomcat??:
+
[source, bash]
----
$ docker save -o ose3-builder-images.tar \
    registry.redhat.io/jboss-webserver-3/webserver31-tomcat7-openshift:<tag> \
    registry.redhat.io/jboss-webserver-3/webserver31-tomcat8-openshift:<tag> \
    registry.redhat.io/openshift3/jenkins-2-rhel7:<tag> \
    registry.redhat.io/openshift3/jenkins-agent-maven-35-rhel7:<tag> \
    registry.redhat.io/openshift3/jenkins-agent-nodejs-8-rhel7:<tag> \
    registry.redhat.io/openshift3/jenkins-slave-base-rhel7:<tag> \
    registry.redhat.io/openshift3/jenkins-slave-maven-rhel7:<tag> \
    registry.redhat.io/openshift3/jenkins-slave-nodejs-rhel7:<tag>
----

. ?????????????????????

. ????????:
+
[source, bash]
----
$ docker load -i ose3-images.tar
$ docker load -i ose3-builder-images.tar
$ docker load -i ose3-optional-images.tar
----

[[disconnected-repo-server]]
== ???????????

??????,????????????,??????web?????????
RHEL 7????Apache Web????

. Prepare the webserver:
.. ????????????????????web???,??LAN???????RHEL 7??,
??????110 GB?????RHEL?????,??*??Web???* ???
.. ??????????{product-title}???????????,????????Apache:
+
[source, bash]
----
$ sudo yum install httpd
----

. ????????Apache’s??????
** ??????????:
+
[source, bash]
----
$ mv /path/to/repos /var/www/html/
$ chmod -R +r /var/www/html/repos
$ restorecon -vR /var/www/html
----

** ?????????????,??????,??????:
+
[source, bash]
----
$ cp -a /path/to/repos /var/www/html/
$ chmod -R +r /var/www/html/repos
$ restorecon -vR /var/www/html
----

. ???????:
+
[source, bash]
----
$ sudo firewall-cmd --permanent --add-service=http
$ sudo firewall-cmd --reload
----

. ?????Apache,?????:
+
[source, bash]
----
$ systemctl enable httpd
$ systemctl start httpd
----

[[disconnected-populate-registry]]
== ?????

??????????,????????????????:

[IMPORTANT]
====
?????????????????????????????????????????
====

. ???????????,??????????
** ??`openshift3`???????,????????????????
??,???{product-title}????:
+
[source, bash]
----
$ docker tag registry.redhat.io/openshift3/ose-node:<tag> registry.example.com/openshift3/ose-node:<tag>
$ docker tag registry.redhat.io/openshift3/ose-node:<tag> registry.example.com/openshift3/ose-node:{major-tag}
----
** ??????,???????????????,???etcd??:
+
[source, bash]
----
$ docker tag registry.redhat.io/rhel7/etcd:3.2.22 registry.example.com/rhel7/etcd:3.2.22
----

. ?????????????,???{product-title}????:
+
[source, bash]
----
$ docker push registry.example.com/openshift3/ose-node:<tag>
$ docker push registry.example.com/openshift3/ose-node:{major-tag}
----

[[disconnected-openshift-systems]]
== ??????

???????????,????????

. ???{product-title}????????????????RHEL 7?????????
??????
xref:../install/prerequisites.adoc#install-config-install-prerequisites[????]?

. ????????,???????? ???????*_/etc/yum.repos.d/ose.repo_* ??:
+
----
[rhel-7-server-rpms]
name=rhel-7-server-rpms
baseurl=http://<server_IP>/repos/rhel-7-server-rpms <1>
enabled=1
gpgcheck=0
[rhel-7-server-extras-rpms]
name=rhel-7-server-extras-rpms
baseurl=http://<server_IP>/repos/rhel-7-server-extras-rpms <1>
enabled=1
gpgcheck=0
[rhel-7-server-ansible-2.6-rpms]
name=rhel-7-server-ansible-2.6-rpms
baseurl=http://<server_IP>/repos/rhel-7-server-ansible-2.6-rpms <1>
enabled=1
gpgcheck=0
[rhel-7-server-ose-3.11-rpms]
name=rhel-7-server-ose-3.11-rpms
baseurl=http://<server_IP>/repos/rhel-7-server-ose-3.11-rpms <1>
enabled=1
gpgcheck=0
----
<1> ???????Apache????IP????????`<server_IP>`?

. ??????????????
xref:host_preparation.adoc#install-config-install-host-preparation[??????]
??,??? *????* ??????

[[disconnected-installing-openshift]]
== ??{product-title}

????????????,??????????{product-title}:

. xref:configuring_inventory_file.adoc#configuring-ansible[????????]
?????????:
+
----
oreg_url=registry.example.com/openshift3/ose-${component}:${version}
openshift_examples_modify_imagestreams=true
----

. xref:running_install.adoc#install-running-installation-playbooks[??????]?
////
+
[IMPORTANT]
====
???????????`<tag>`??,?? *{latest-tag}*,
??`openshift_image_tag`?????
??????????????,??????????????????????,
????????
====
////
